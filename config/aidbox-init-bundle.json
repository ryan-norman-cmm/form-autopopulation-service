{
  "resourceType": "Bundle",
  "id": "form-auto-population-init-bundle",
  "type": "transaction",
  "entry": [
    {
      "request": {
        "method": "PUT",
        "url": "Client/form-auto-population-service"
      },
      "resource": {
        "resourceType": "Client",
        "id": "form-auto-population-service",
        "secret": "{{FORM_AUTOPOPULATION_CLIENT_SECRET}}",
        "grant_types": ["client_credentials"],
        "scope": [
          "system/Patient.read",
          "system/Questionnaire.*",
          "system/QuestionnaireResponse.*",
          "system/Subscription.*"
        ]
      }
    },
    {
      "request": {
        "method": "PUT",
        "url": "AccessPolicy/as-client-questionnaire-read"
      },
      "resource": {
        "resourceType": "AccessPolicy",
        "id": "as-client-questionnaire-read",
        "description": "Allow form-auto-population-service to read and search Questionnaire resources",
        "engine": "matcho",
        "matcho": {
          "client": {
            "id": "form-auto-population-service"
          },
          "request-method": {
            "$enum": ["get"]
          },
          "uri": "#^/fhir/Questionnaire.*$"
        }
      }
    },
    {
      "request": {
        "method": "PUT",
        "url": "AccessPolicy/as-client-questionnaire-write"
      },
      "resource": {
        "resourceType": "AccessPolicy",
        "id": "as-client-questionnaire-write",
        "description": "Allow form-auto-population-service to create, update, delete Questionnaire resources",
        "engine": "matcho",
        "matcho": {
          "client": {
            "id": "form-auto-population-service"
          },
          "request-method": {
            "$enum": ["post", "put", "patch", "delete"]
          },
          "uri": "#^/fhir/Questionnaire.*$"
        }
      }
    },
    {
      "request": {
        "method": "PUT",
        "url": "AccessPolicy/as-client-questionnaireresponse-read"
      },
      "resource": {
        "resourceType": "AccessPolicy",
        "id": "as-client-questionnaireresponse-read",
        "description": "Allow form-auto-population-service to read and search QuestionnaireResponse resources",
        "engine": "matcho",
        "matcho": {
          "client": {
            "id": "form-auto-population-service"
          },
          "request-method": {
            "$enum": ["get"]
          },
          "uri": "#^/fhir/QuestionnaireResponse.*$"
        }
      }
    },
    {
      "request": {
        "method": "PUT",
        "url": "AccessPolicy/as-client-questionnaireresponse-write"
      },
      "resource": {
        "resourceType": "AccessPolicy",
        "id": "as-client-questionnaireresponse-write",
        "description": "Allow form-auto-population-service to create, update QuestionnaireResponse resources",
        "engine": "matcho",
        "matcho": {
          "client": {
            "id": "form-auto-population-service"
          },
          "request-method": {
            "$enum": ["post", "put", "patch"]
          },
          "uri": "#^/fhir/QuestionnaireResponse.*$"
        }
      }
    },
    {
      "request": {
        "method": "POST",
        "url": "AidboxSubscriptionTopic"
      },
      "resource": {
        "resourceType": "AidboxSubscriptionTopic",
        "id": "questionnaire-response.auto-populated.created",
        "url": "http://example.org/FHIR/R5/SubscriptionTopic/QuestionnaireResponse-Autopopulation-topic",
        "status": "active",
        "trigger": [
          {
            "resource": "QuestionnaireResponse",
            "supportedInteraction": ["create"]
          }
        ]
      }
    },
    {
      "request": {
        "method": "POST",
        "url": "AidboxTopicDestination"
      },
      "resource": {
        "resourceType": "AidboxTopicDestination",
        "meta": {
          "profile": [
            "http://aidbox.app/StructureDefinition/aidboxtopicdestination-kafka-at-least-once"
          ]
        },
        "kind": "kafka-at-least-once",
        "id": "questionnaire-response-autopulation-create-kafka",
        "topic": "http://example.org/FHIR/R5/SubscriptionTopic/QuestionnaireResponse-Autopopulation-topic",
        "parameter": [
          {
            "name": "kafkaTopic",
            "valueString": "{{FORM_POPULATION_COMPLETED_TOPIC}}"
          },
          {
            "name": "bootstrapServers",
            "valueString": "{{KAFKA_INTERNAL_HOST}}:{{KAFKA_INTERNAL_PORT}}"
          }
        ]
      }
    }
  ]
}
